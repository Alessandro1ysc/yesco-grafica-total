<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Yesco Gr치fica Total</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      text-align: center;
      background: #f5f5f5;
    }
    h1 {
      margin-bottom: 10px;
    }
    #total {
      font-size: 2rem;
      margin: 20px 0;
      color: #111;
    }
    #contador {
      font-size: 1.2rem;
      color: gray;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Yesco Gr치fica Total</h1>
  <div id="total">Cargando valor total...</div>
  <div id="contador">Actualizaci칩n en: --:--:--</div>

  <script>
    const formatNumber = n => n.toLocaleString('es-PE');

    async function obtenerTotal() {
      try {
        const res = await fetch("https://yesco-data.onrender.com/total.json");
        const data = await res.json();
        const total = data.total;
        document.getElementById('total').textContent = `S/. ${formatNumber(total)}`;
      } catch (e) {
        document.getElementById('total').textContent = 'Error al cargar datos';
        console.error(e);
      }
    }

    function segundosHastaProximaHoraPeru() {
      const ahora = new Date();
      const utc = ahora.getTime() + (ahora.getTimezoneOffset() * 60000);
      const lima = new Date(utc - (5 * 60 * 60 * 1000));
      const minutosRest = 59 - lima.getMinutes();
      const segundosRest = 59 - lima.getSeconds();
      return (minutosRest * 60) + segundosRest + 1;
    }

    function iniciarContador() {
      let segundos = segundosHastaProximaHoraPeru();
      setInterval(() => {
        segundos--;
        if (segundos <= 0) {
          obtenerTotal();
          segundos = 3600;
        }
        const h = String(Math.floor(segundos / 3600)).padStart(2, '0');
        const m = String(Math.floor((segundos % 3600) / 60)).padStart(2, '0');
        const s = String(segundos % 60).padStart(2, '0');
        document.getElementById('contador').textContent = `Actualizaci칩n en: ${h}:${m}:${s}`;
      }, 1000);
    }

    obtenerTotal();
    iniciarContador();
  </script>
</body>
</html>
